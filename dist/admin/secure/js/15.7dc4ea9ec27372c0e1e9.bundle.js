(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{501:function(e,t,s){"use strict";s.r(t);var a=s(7),i=s(5),r=s(16),n=s(1),o=s(0),l=s(47),c=s.n(l),u=s(87),d=s(9),h=s(86),g=s(214),p=s(8),b=s(22),j=s(2);class m extends o.Component{constructor(e){super(e),Object(r.a)(this,"onCancel",()=>{this.props.onChange(this.originalFile),this.setState({changeStatus:this.originalFile?"stored":"empty",dataURI:null,errorMessage:null})}),Object(r.a)(this,"onRemove",()=>{this.setState({changeStatus:"removed",errorMessage:null}),this.props.onChange(null)}),Object(r.a)(this,"onChange",({target:{validity:e,files:[t]}})=>{if(!t)return;const{errorMessage:s,onChange:a}=this.props;e.valid?t.type.includes("image")?(this.state.errorMessage&&this.setState({errorMessage:null}),this.setState({changeStatus:"updated",oldImagePath:this.getImagePath()}),a(t),this.getDataURI(t)):this.setState({errorMessage:s({type:"invalid"})}):this.setState({errorMessage:s({type:"save"})})}),Object(r.a)(this,"openFileBrowser",()=>{this.inputRef&&this.inputRef.click()}),Object(r.a)(this,"getFile",()=>{const{value:e}=this.props,{changeStatus:t}=this.state,s="removed"===t?this.originalFile:e;return{file:s,type:s&&s.__typename?"server":"client"}}),Object(r.a)(this,"getDataURI",e=>{const{errorMessage:t}=this.props,s=new FileReader;s.readAsDataURL(e),s.onloadstart=()=>{this.setState({isLoading:!0})},s.onerror=e=>{console.error("Error with Cloudinary preview",e),this.setState({errorMessage:t({type:"preview"})})},s.onloadend=e=>{this.setState({isLoading:!1,dataURI:e.target.result})}}),Object(r.a)(this,"getImagePath",()=>{const{dataURI:e,oldImagePath:t}=this.state,{file:s}=this.getFile();return s&&s.publicUrlTransformed||e||t}),Object(r.a)(this,"getInputRef",e=>{this.inputRef=e}),Object(r.a)(this,"renderUploadButton",()=>{const{uploadButtonLabel:e,isDisabled:t}=this.props,{changeStatus:s,isLoading:a}=this.state;return Object(n.jsx)(p.c,{onClick:this.openFileBrowser,isLoading:a,variant:"ghost",isDisabled:t},e({status:s}))}),Object(r.a)(this,"renderCancelButton",()=>{const{cancelButtonLabel:e,isDisabled:t}=this.props,{changeStatus:s}=this.state;let a="warning",i=this.onRemove;switch(s){case"removed":a="primary",i=this.onCancel;break;case"updated":i=this.onCancel}return Object(n.jsx)(p.a,{onClick:i,variant:"subtle",appearance:a,isDisabled:t},e({status:s}))});const{value:t}=e;this.originalFile=t;const s=this.originalFile?"stored":"empty";this.state={changeStatus:s,dataURI:null,errorMessage:null,isLoading:!1,oldImagePath:null}}render(){const{autoFocus:e,field:t,statusMessage:s,errors:a,isDisabled:i}=this.props,{changeStatus:r,errorMessage:o}=this.state,{file:l}=this.getFile(),c=this.getImagePath(),d=["removed","updated"].includes(r),g="empty"===r,p="ks-input-"+t.path;return Object(n.jsx)(u.a,null,Object(n.jsx)(u.d,{htmlFor:p,field:t,errors:a}),Object(n.jsx)(u.b,{text:t.adminDoc}),Object(n.jsx)(u.c,null,!g&&c?Object(n.jsx)(O,null,Object(n.jsx)(x,{src:c,alt:t.path}),Object(n.jsx)(f,null,Object(n.jsx)(b.d,{style:{marginBottom:j.d}},this.renderUploadButton(),this.renderCancelButton()),o?Object(n.jsx)(R,null,o):l?Object(n.jsx)(b.d,{isInline:!0,growIndexes:[0]},Object(n.jsx)(v,null,l.filename||l.name),d?Object(n.jsx)(y,{status:r},s({status:r})):null):null)):this.renderUploadButton(),Object(n.jsx)(h.b,{autoComplete:"off",autoFocus:e,id:p,ref:this.getInputRef,name:t.path,onChange:this.onChange,type:"file",disabled:i})))}}Object(r.a)(m,"propTypes",{cancelButtonLabel:c.a.func.isRequired,disabled:c.a.bool,errorMessage:c.a.func.isRequired,field:c.a.object,onChange:c.a.func.isRequired,statusMessage:c.a.func.isRequired,uploadButtonLabel:c.a.func.isRequired}),Object(r.a)(m,"defaultProps",{cancelButtonLabel:function({status:e}){switch(e){case"stored":return"Remove Image";case"removed":return"Undo Remove";case"updated":default:return"Cancel"}},errorMessage:function({type:e}){switch(e){case"invalid":return"Only image files are allowed. Please try again.";case"save":return"Something went wrong, please reload and try again.";case"preview":return"Something went wrong, please try again."}},statusMessage:function({status:e}){switch(e){case"removed":return"save to remove";case"updated":return"save to upload"}},uploadButtonLabel:function({status:e}){return"empty"===e?"Upload Image":"Change Image"}});const O=e=>Object(n.jsx)("div",Object(i.a)({css:{alignItems:"flex-start",display:"flex"}},e)),f=e=>Object(n.jsx)("div",Object(i.a)({css:{flex:1,minWidth:0}},e)),x=e=>Object(n.jsx)("div",{css:{backgroundColor:"white",borderRadius:j.a,border:"1px solid "+j.b.N20,flexShrink:0,lineHeight:0,marginRight:j.d,padding:4,position:"relative",textAlign:"center",width:130}},Object(n.jsx)("img",Object(i.a)({css:{height:"auto",maxWidth:"100%"}},e))),v=e=>Object(n.jsx)(g.a,Object(i.a)({crop:"right"},e)),R=e=>{let{children:t}=e,s=Object(a.a)(e,["children"]);return Object(n.jsx)(g.a,Object(i.a)({style:{backgroundColor:j.b.R.L80,borderColor:"transparent",color:j.b.R.D20,display:"inline-flex"}},s),Object(n.jsx)(d.a,{css:{marginRight:j.d}}),t)},w={default:"primary",removed:"danger",updated:"create"},y=e=>{let{status:t="default"}=e,s=Object(a.a)(e,["status"]);const r=w[t];return Object(n.jsx)(g.a,Object(i.a)({appearance:r},s))};t.default=m}}]);